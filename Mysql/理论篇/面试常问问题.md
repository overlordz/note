#### 说一下MySQL的索引结构是什么样的 ？聚簇索引和非聚簇索引又是什么？

> 发展过程：二叉树  》 AVL树 》红黑树 》B - 树 》B+树

二叉树:每个节点最多只有两个子节点，左边的子节点都比当前节点小，右边的子节点都比当前节点大。

AVL树:树中任意节点的两个子树的高度差最大为1

红黑树: 1、每个节点都是红色或者黑色。2、根节点是黑色。3、每个叶子节点都是黑色的空节点。4、红色节点的父子节点都必须是黑色。5、从任一节点到其每个叶子节点的所有路径都包含相同的黑色节点。

B-树: 1、B-树的每个非叶子节点的子节点个数都不会超过D (这个D就是B树的阶) 2、所有的叶子节点都在同一层。3.、所有节点关键字都是按照递增顺序排列。

B+树: 1、 非叶子节点不存储数据，只进行数据索引。2、所有数据都存储在叶子节点当中。3、每个叶子节点都存有相邻叶子节点的指针。4、叶子节点按照本身关键字从小到大排序。



聚簇索引就是数据和索引是在一起的。

MyISAM 使用的是非聚簇索引，树的子节点上的 data 不是数据本身，而是数据存放的地址。InnoDB采用的是聚簇索引， 树叶子节点上的 data 就是数据本身。

聚簇索引的数据物理存放顺序和索引顺序是一致的， 所以一个表当中只能有一个聚簇索引，而非聚簇索引可以有多个。

InnoDB 中，如果表定义了 PK (主键)，那 PK(主键) 就是聚簇索引。如果没有PK(主键) ， 就会找第一个非空的 unique 列作为聚簇索引。 否则，InnoDB 会创建一个隐藏的 row-id 作为聚簇索引。



MySQL的覆盖索引和回表

如果只需要在一颗索引树上就可以获取 SQL 所需要的所有列，就不需要再回表查询，这样查询速度就可以更快。
实现索引覆盖最简单的方式就是将要查询的字段，全部建立到联合索引当中。

user (PK id, name ,sex)
select count(name) from user; ->在name字段上建立一个索引。
select id，name ,sex from user; ->将name. 上的索弓|升级成为(name,sex)的联合索引。



#### 说一下-MySQL的锁有哪些？什么是间隙锁？



从锁的粒度来区分
1、行锁:加锁粒度小，但是加锁资源开销比较大。 InnDB支持。
共享锁:读锁。 多个事务可以对同-一个数据共享同一把锁。持有锁的事务都可以访问数据，但是只能读不能修改。select XXX LOCK IN SHARE MODE。

排他锁:写锁。 只有一一个事务能够获得排他锁，其他事务都不能获取该行的锁。InnoDB会对update\delete\insert语句自动添加排他锁。SELECT XXX FOR UPDATE。

自增锁:通常是针对MySQL当中的自增字段。如果有事务回滚这种情况，数据会回滚，但是自增序列不会回滚。

2、表锁:加锁粒度大，加锁资源开销比较小。MyISAM和InnoDB都支持。

表共享读锁
表排他写锁
意向锁:是InnoDB自动添加的一种锁，不需要用户干预。

3、全局锁: Flush tables with read lock。加锁之后整个数据库实例都处于只读状态。所有的数据变更操作都会被挂起。

一般用于全库备份的时候。


常见的锁算法: user: userid ( 1,4,9) update user set xxX where userid= 5; REPEATABLE READ间隙锁锁住(5,9)

1、记录锁:锁一条具体的数据。
2、间隙锁: RR隔离级别下，会加间隙锁。锁一定的范围，而不锁具体的记录。是为了防止产生幻读。(-xx,1)(1,4)(4,9) (9，
XXx)
3、Next-key :间隙锁+右记录锁。(-xx,1](1,4](4,9] (9, xxx)



说一下什么是倒排索引

说一下什么是索引数据结构红黑树，Hash，B+树

你知道千万级数据表如何用索引快速查找吗

说一下如何基于索引B+树精准建立高性能索引

说一下联合索引底层数据结构又是怎样的

说一下聚集索引与覆盖索引与索引下推到底是什么

为什么推荐使用自增整型的主键而不是UUID

你知道Mysql最左前缀优化原则是怎么回事吗

Mysql并发支撑底层Buffer Pool机制讲解

说一下你理解的Innodb存储基本单位页结构

说一下索引底层原理与执行流程

你知道Mysql是如何选择最优索引的吗

说一下覆盖索引底层原理与执行流程

说一下索引下推底层原理与执行流程

你知道Mysql为什么会出现索引失效吗

亿级流量下Mysql索引应该怎么优化

为什么大厂都要基于Mysql开发自研数据库

Pool内存结构详解与优化策略解析

说一下Mysql事务底层实现原理

你知道Innodb本身针对写语句做了哪些优化吗

说一下MVCC机制是如何保证事务的隔离性的

超高并发下使用事务时避免死锁的方法

说一下分布式事务与Mysql事务之间的关系是什么

超高并发下如何正确的使用Mysql事务及优化

讲一下MySQL集群如何搭建



#### 谈谈如何对MySQL进行分库分表

> 谈谈如何对MySQL进行分库分表 ? 多大数据量需要进行分库分表?分库分表的方式和分片策略由哪些 ? 分库分表后，SQL语句的执行流程是怎样的?

什么是分库分表?就是当表中的数据量过大时，整个查询效率就会降低得非常明显。这时为了提升查询效率，就要将一个表中的数据分散到多个数据库的多个表当中。

数据分片的方式有垂直分片和水平分片。垂直分片就是从业务角度将不同的表拆分到不同的库中，能够解决数据库数据文件过大的问题，但是不能从根本上解决查询问题。水平分片就是从数据角度将一个表中的数据拆分到不同的库或表中， 这样可以从根本上解决数据量过大造成的查询效率低的问题。

有非常多的分片策略，比如取模、按时间、按枚举值。。。 

阿里提供的开发手册当中，建议: -个表的数据量超过500W或者数据文件超过2G,就要考虑分库分表了。